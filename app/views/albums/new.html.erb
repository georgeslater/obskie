<div id="basic_info">

<div class="jumbotron">
  <p>Thank you for contributing to ObscureAlbums.com!  Please enter the album information below and select the correct match from the results returned.  If the album isn't there or the list is empty, please reach out to us.</p>
</div>

  <div class="field">
    <div>Artist Name</div>
    <input id="artist">
  </div>
  <button onclick="getArtists();">Search</button>

  <div id="artistResultsWrapper" style="display: none;">
  	<select id="artistResults">

  	</select>
  	<button onclick="getAlbums();">Get Albums</button>
  </div>

  <div id="albumResultsWrapper"  style="display: none;">
	  <select id="albumResults">

	  		
	  </select>
	  <button onclick="getTracks();">See Tracks</button>
  </div>

  <div id="trackResultsWrapper" style="display: none;">
  	<ul id="trackResults" >

	</ul>
  </div>
</div>

<button id="submitAlbum" onclick="submit();" style="display: none;">This is my album!</button>
<%= link_to 'Back', albums_path %>

<input id="artistName" type="hidden">

<script>
	
	function submit(){

		var $albumSel = $('#albumResults option:selected');

		if($albumSel){

			var id = $albumSel.data('mbid');

			$.ajax({
		      type: 'GET',
		      url: '/submitAlbum',
		      data: {
		        album_selected: id,
		        artist_selected: $('#artistName').val()
		      },
		      format: 'js',
		      success: function(result) {
		      	
		      	window.location ='/albums/'+result['id']+'/edit';
		      },
		      error: function (jqXHR, status, err) {
			    alert(err);
			  }
		   });
		}
	}

	function getAlbums(){

		var $artistSel = $('#artistResults option:selected');
		
		if($artistSel){
			
			var id = $artistSel.data('mbid');

			$('#artistName').val($artistSel.val());

			$.ajax({
		      type: 'GET',
		      url: '/search/albums',
		      data: {
		        artist_selected: id
		      },
		      format: 'js',
		      success: function(result) {
		      	
		      	console.log(result)
		      	
		      	var html = '';

		      	for(var i = 0; i < result.length; i++){

		      		album = result[i];
		      		html += "<option data-mbid='"+album['id']+"'>"+album['title']+"</option>"
		      	}

		      	$('#albumResults').html(html);
		      	$('#trackResults').empty();
		      	$('#albumResultsWrapper').css('display', 'block');
		      	$('#submitAlbum').css('display', 'block');
		      }
		   });
		}
	}

	function getTracks(){

		var $albumSel = $('#albumResults option:selected');
		
		if($albumSel){
			
			var id = $albumSel.data('mbid');

			$.ajax({
		      type: 'GET',
		      url: '/search/tracks',
		      data: {
		        album_selected: id
		      },
		      format: 'js',
		      success: function(result) {
		      	
		      	console.log(result);

		      	var html = "";
		      	for(var i = 0; i < result.length; i++){

		      		track = result[i];
		      		html += "<li>"+track['title']+"</li>";
		      	}

		      	$('#trackResults').html(html);
		      	$('#trackResultsWrapper').css('display', 'block');
		      }
		   });
		}
	} 

	function getArtists(){

		var artistName = $('#artist').val();

		if(artistName && artistName.trim().length){

			$.ajax({
		      type: 'GET',
		      url: '/search/artists',
		      data: {
		        artist: artistName,
		      },
		      format: 'js',
		      success: function(result) {
		      	console.log(result)
		      	
		      	var html = '';

		      	for(var i = 0; i < result.length; i++){

		      		artist = result[i];
		      		html += "<option data-mbid='"+artist['mbid']+"'>"+artist['name']+"</option>"
		      	}

		      	$('#artistResults').html(html);
		      	$('#trackResults').empty();
		      	$('#albumResults').empty();
		      	$('#artistResultsWrapper').css('display', 'block');
		      }
		   });

		}else{

			alert('Please fill in all fields!');
		}

	}
</script>
